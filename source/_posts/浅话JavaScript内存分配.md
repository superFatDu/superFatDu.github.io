---
title: 浅话JavaScript内存分配
date: 2021-4-9 14:52:03
tags: [JavaScript,内存]
categories: 前端
comment: true
---

## 堆、栈、队列

### 数据结构层面

#### 堆

堆是一种经过排序的树形数据结构，每个节点都有一个值，通常我们所说的堆的数据结构是指二叉树。

![heap](https://cdn.jsdelivr.net/gh/superFatDu/blogPics@main/20210507/heap.5jnhsr00k1c0.webp)

#### 栈

1. 栈是限定仅在表尾进行插入和删除操作的线性表。我们把允许插入和删除的一端称为栈顶，另一端称为栈底，不含任何数据元素的栈称为空栈。栈的特殊之处在于它限制了这个线性表的插入和删除位置，它始终只在栈顶进行，就是先进后出（First In Last Out）。

2. 堆栈中定义了一些操作。两个最重要的是PUSH和POP。

![stack](https://cdn.jsdelivr.net/gh/superFatDu/blogPics@main/20210508/栈stack.3hmv0jacyh00.svg)

#### 队列

1. 队列是只允许在一端进行插入操作、而在另一端进行删除操作的线性表。允许插入的一端称为队尾，允许删除的一端称为队头。它是一种特殊的线性表，特殊之处在于它只允许在表的前端进行删除操作，而在表的后端进行插入操作，和栈一样，队列是一种操作受限制的线性表。

2. 而且队列是一种先进先出的数据结构，又称为先进先出的线性表，简称 FIFO（First In First Out）结构。

![queue](https://cdn.jsdelivr.net/gh/superFatDu/blogPics@main/20210508/队列queue.1t1zd1z7edvk.svg)

### 内存分配层面

JS内存空间分为：

1. 栈(stack)
2. 堆(heap)
3. 池(一般也会归类为栈中)
4. 运行时环境（函数运行时）

其中栈存放变量，堆存放复杂对象，池存放基本类型常量。

![内存分配](https://cdn.jsdelivr.net/gh/superFatDu/blogPics@main/20210508/js内存分配.79ayz3gwsmk0.svg)

🚨 Notice：在运行时环境解析函数时，会为函数重新开辟一块临时内存空间，这块内存空间和其他的一样，也有自己的堆栈，然后函数运行完就会销毁。

#### 申请方式不同

1. 栈是系统自动分配空间的，而堆则是程序员根据需要自己申请的空间。
2. 由于栈上的空间是自动分配自动回收的，所以栈上的数据的生存周期只是在函数的运行过程中，运行后就释放掉，不可以再访问。而堆上的数据只要程序员不释放空间，就一直可以访问到，不过缺点是一旦忘记释放会造成内存泄露。

#### 申请效率不同

1. 栈由系统自动分配，速度较快。但程序员是无法控制的。
2. 堆是由malloc(),free(),new()分配的内存（memory allocation），一般速度比较慢，而且容易产生内存碎片，不过用起来最方便。

#### 申请大小限制

1. 栈是向低地址扩展的数据结构，是一块连续的内存的区域。这句话的意思是栈顶的地址和栈的最大容量是系统预先规定好的，在Windows下，栈的大小是2M（也有的说是1M，总之是一个编译时就确定的常数），如果申请的空间超过栈的剩余空间时，将提示overflow。因此，能从栈获得的空间较小。
2. 堆是向高地址扩展的数据结构，是不连续的内存区域。这是由于系统是用链表来存储空闲内存地址的，自然是不连续的，而链表的遍历方向是由低地址向高地址。堆的大小受限于计算机系统中有效的虚拟内存。由此可见，堆获得的空间比较灵活，也比较大。
